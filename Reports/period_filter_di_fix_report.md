# –û—Ç—á–µ—Ç –æ–± –∏—Å–ø—Ä–∞–≤–ª–µ–Ω–∏–∏ –Ω–∞—Ä—É—à–µ–Ω–∏–π –∞—Ä—Ö–∏—Ç–µ–∫—Ç—É—Ä—ã DI

## üö® –ö—Ä–∏—Ç–∏—á–µ—Å–∫–∞—è –ø—Ä–æ–±–ª–µ–º–∞

–û–±–Ω–∞—Ä—É–∂–µ–Ω–æ —Å–µ—Ä—å–µ–∑–Ω–æ–µ –Ω–∞—Ä—É—à–µ–Ω–∏–µ –∞—Ä—Ö–∏—Ç–µ–∫—Ç—É—Ä–Ω–æ–≥–æ –ø—Ä–∏–Ω—Ü–∏–ø–∞ **Dependency Injection** - –ø—Ä—è–º–æ–µ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–µ `PeriodService` –≤ —Ä–µ–ø–æ–∑–∏—Ç–æ—Ä–∏—è—Ö –±–µ–∑ –≤–Ω–µ–¥—Ä–µ–Ω–∏—è —á–µ—Ä–µ–∑ DI –∫–æ–Ω—Ç–µ–π–Ω–µ—Ä.

## üîß –í—ã–ø–æ–ª–Ω–µ–Ω–Ω—ã–µ –∏—Å–ø—Ä–∞–≤–ª–µ–Ω–∏—è

### 1. –ü—Ä–µ–æ–±—Ä–∞–∑–æ–≤–∞–Ω–∏–µ PeriodService –≤ –æ–±—ã—á–Ω—ã–π –∫–ª–∞—Å—Å

**–ü—Ä–æ–±–ª–µ–º–∞**: PeriodService –±—ã–ª —Å—Ç–∞—Ç–∏—á–µ—Å–∫–∏–º –∫–ª–∞—Å—Å–æ–º —Å–æ —Å—Ç–∞—Ç–∏—á–µ—Å–∫–∏–º–∏ –º–µ—Ç–æ–¥–∞–º–∏
**–†–µ—à–µ–Ω–∏–µ**: –ü—Ä–µ–æ–±—Ä–∞–∑–æ–≤–∞–Ω –≤ –æ–±—ã—á–Ω—ã–π –∫–ª–∞—Å—Å —Å –º–µ—Ç–æ–¥–∞–º–∏ —ç–∫–∑–µ–º–ø–ª—è—Ä–∞

```python
# –î–æ:
class PeriodService:
    @staticmethod
    def get_period_dates(period_type: str, period_offset: int = 0) -> Tuple[date, date]:

# –ü–æ—Å–ª–µ:
class PeriodService:
    def get_period_dates(self, period_type: str, period_offset: int = 0) -> Tuple[date, date]:
```

**–ò–∑–º–µ–Ω–µ–Ω–Ω—ã–µ –º–µ—Ç–æ–¥—ã**:
- `get_period_dates()` - –æ—Å–Ω–æ–≤–Ω–æ–π –º–µ—Ç–æ–¥ –≤—ã—á–∏—Å–ª–µ–Ω–∏—è –¥–∞—Ç
- `_get_week_dates()` - –≤—ã—á–∏—Å–ª–µ–Ω–∏–µ –Ω–µ–¥–µ–ª—å–Ω—ã—Ö –ø–µ—Ä–∏–æ–¥–æ–≤
- `_get_month_dates()` - –≤—ã—á–∏—Å–ª–µ–Ω–∏–µ –º–µ—Å—è—á–Ω—ã—Ö –ø–µ—Ä–∏–æ–¥–æ–≤
- `_get_quarter_dates()` - –≤—ã—á–∏—Å–ª–µ–Ω–∏–µ –∫–≤–∞—Ä—Ç–∞–ª—å–Ω—ã—Ö –ø–µ—Ä–∏–æ–¥–æ–≤
- `_get_year_dates()` - –≤—ã—á–∏—Å–ª–µ–Ω–∏–µ –≥–æ–¥–æ–≤—ã—Ö –ø–µ—Ä–∏–æ–¥–æ–≤
- `get_period_label()` - –≥–µ–Ω–µ—Ä–∞—Ü–∏—è –º–µ—Ç–æ–∫ –ø–µ—Ä–∏–æ–¥–æ–≤
- `validate_period_params()` - –≤–∞–ª–∏–¥–∞—Ü–∏—è –ø–∞—Ä–∞–º–µ—Ç—Ä–æ–≤
- `get_period_info()` - –ø–æ–ª—É—á–µ–Ω–∏–µ –ø–æ–ª–Ω–æ–π –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏–∏ –æ –ø–µ—Ä–∏–æ–¥–µ

### 2. –û–±–Ω–æ–≤–ª–µ–Ω–∏–µ DI –∫–æ–Ω—Ç–µ–π–Ω–µ—Ä–∞

**–ü—Ä–æ–±–ª–µ–º–∞**: PeriodService –Ω–µ –±—ã–ª –∑–∞—Ä–µ–≥–∏—Å—Ç—Ä–∏—Ä–æ–≤–∞–Ω –≤ DI –∫–æ–Ω—Ç–µ–π–Ω–µ—Ä–µ
**–†–µ—à–µ–Ω–∏–µ**: –î–æ–±–∞–≤–ª–µ–Ω –ø—Ä–æ–≤–∞–π–¥–µ—Ä Factory –¥–ª—è PeriodService

```python
# –î–æ–±–∞–≤–ª–µ–Ω–æ –≤ containers.py:
period_service = providers.Factory(PeriodService)
```

**–ü–æ–∑–∏—Ü–∏–æ–Ω–∏—Ä–æ–≤–∞–Ω–∏–µ**: –û–ø—Ä–µ–¥–µ–ª–µ–Ω —Ä–∞–Ω–æ –≤ –∫–æ–Ω—Ç–µ–π–Ω–µ—Ä–µ, —Ç–∞–∫ –∫–∞–∫ –∏—Å–ø–æ–ª—å–∑—É–µ—Ç—Å—è –≤ —Ä–µ–ø–æ–∑–∏—Ç–æ—Ä–∏—è—Ö

### 3. –û–±–Ω–æ–≤–ª–µ–Ω–∏–µ ReservationFilterRepository

**–ü—Ä–æ–±–ª–µ–º–∞**: –ü—Ä—è–º–æ–µ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–µ `PeriodService.get_period_dates()`
**–†–µ—à–µ–Ω–∏–µ**: –í–Ω–µ–¥—Ä–µ–Ω–∏–µ —á–µ—Ä–µ–∑ –∫–æ–Ω—Å—Ç—Ä—É–∫—Ç–æ—Ä

```python
# –î–æ:
from shared.services.period_service import PeriodService
# –ò—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–µ: PeriodService.get_period_dates(period_type, period_offset)

# –ü–æ—Å–ª–µ:
def __init__(self, db: AsyncSession, period_service: PeriodService):
    super().__init__(db)
    self.period_service = period_service
# –ò—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–µ: self.period_service.get_period_dates(period_type, period_offset)
```

### 4. –û–±–Ω–æ–≤–ª–µ–Ω–∏–µ RentalQueryRepository

**–ü—Ä–æ–±–ª–µ–º–∞**: –ü—Ä—è–º–æ–µ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–µ `PeriodService.get_period_dates()`
**–†–µ—à–µ–Ω–∏–µ**: –í–Ω–µ–¥—Ä–µ–Ω–∏–µ —á–µ—Ä–µ–∑ –∫–æ–Ω—Å—Ç—Ä—É–∫—Ç–æ—Ä

```python
def __init__(self, db: AsyncSession, period_service: PeriodService):
    super().__init__(db)
    self.period_service = period_service
```

### 5. –û–±–Ω–æ–≤–ª–µ–Ω–∏–µ ReservationRepository

**–ü—Ä–æ–±–ª–µ–º–∞**: –ù–µ –ø–µ—Ä–µ–¥–∞–≤–∞–ª PeriodService –≤ ReservationFilterRepository
**–†–µ—à–µ–Ω–∏–µ**: –û–±–Ω–æ–≤–ª–µ–Ω –∫–æ–Ω—Å—Ç—Ä—É–∫—Ç–æ—Ä –∏ –ø–µ—Ä–µ–¥–∞—á–∞ –∑–∞–≤–∏—Å–∏–º–æ—Å—Ç–∏

```python
def __init__(self, db: AsyncSession, period_service: PeriodService):
    super().__init__(db)
    self._query_repo = ReservationQueryRepository(db)
    self._filter_repo = ReservationFilterRepository(db, period_service)
    self._availability_repo = ReservationAvailabilityRepository(db)
```

### 6. –û–±–Ω–æ–≤–ª–µ–Ω–∏–µ RentalRepository

**–ü—Ä–æ–±–ª–µ–º–∞**: –ù–µ –ø–µ—Ä–µ–¥–∞–≤–∞–ª PeriodService –≤ RentalQueryRepository
**–†–µ—à–µ–Ω–∏–µ**: –û–±–Ω–æ–≤–ª–µ–Ω –∫–æ–Ω—Å—Ç—Ä—É–∫—Ç–æ—Ä –∏ –ø–µ—Ä–µ–¥–∞—á–∞ –∑–∞–≤–∏—Å–∏–º–æ—Å—Ç–∏

```python
def __init__(self, db: AsyncSession, financial_service=None, period_service: PeriodService = None):
    super().__init__(db)
    self._query_repo = RentalQueryRepository(db, period_service)
    self._command_repo = RentalCommandRepository(db)
    self._financial_repo = RentalFinancialRepository(db, financial_service)
```

**–î–æ–ø–æ–ª–Ω–∏—Ç–µ–ª—å–Ω–æ**: –û–±–Ω–æ–≤–ª–µ–Ω –º–µ—Ç–æ–¥ `get_paginated_for_admin()` –¥–ª—è –ø–µ—Ä–µ–¥–∞—á–∏ –ø–∞—Ä–∞–º–µ—Ç—Ä–æ–≤ –ø–µ—Ä–∏–æ–¥–∞

### 7. –û–±–Ω–æ–≤–ª–µ–Ω–∏–µ DI –ø—Ä–æ–≤–∞–π–¥–µ—Ä–æ–≤

**–ü—Ä–æ–±–ª–µ–º–∞**: –†–µ–ø–æ–∑–∏—Ç–æ—Ä–∏–∏ –Ω–µ –ø–æ–ª—É—á–∞–ª–∏ PeriodService —á–µ—Ä–µ–∑ DI
**–†–µ—à–µ–Ω–∏–µ**: –û–±–Ω–æ–≤–ª–µ–Ω—ã –ø—Ä–æ–≤–∞–π–¥–µ—Ä—ã –≤ –∫–æ–Ω—Ç–µ–π–Ω–µ—Ä–µ

```python
# ReservationRepository:
reservation_repo = providers.Factory(ReservationRepository, db=db_session, period_service=period_service)

# RentalRepository:
rental_repo = providers.Factory(RentalRepository, db=db_session, financial_service=financial_service, period_service=period_service)
```

## ‚úÖ –†–µ–∑—É–ª—å—Ç–∞—Ç –∏—Å–ø—Ä–∞–≤–ª–µ–Ω–∏–π

### –ê—Ä—Ö–∏—Ç–µ–∫—Ç—É—Ä–Ω–∞—è –∫–æ—Ä—Ä–µ–∫—Ç–Ω–æ—Å—Ç—å:
- **‚úÖ Dependency Injection**: PeriodService —Ç–µ–ø–µ—Ä—å –≤–Ω–µ–¥—Ä—è–µ—Ç—Å—è —á–µ—Ä–µ–∑ DI –∫–æ–Ω—Ç–µ–π–Ω–µ—Ä
- **‚úÖ –ò–Ω–≤–µ—Ä—Å–∏—è –∑–∞–≤–∏—Å–∏–º–æ—Å—Ç–µ–π**: –†–µ–ø–æ–∑–∏—Ç–æ—Ä–∏–∏ –∑–∞–≤–∏—Å—è—Ç –æ—Ç –∞–±—Å—Ç—Ä–∞–∫—Ü–∏–∏, –∞ –Ω–µ –æ—Ç –∫–æ–Ω–∫—Ä–µ—Ç–Ω–æ–π —Ä–µ–∞–ª–∏–∑–∞—Ü–∏–∏
- **‚úÖ –ï–¥–∏–Ω–∞—è —Ç–æ—á–∫–∞ —É–ø—Ä–∞–≤–ª–µ–Ω–∏—è**: –í—Å–µ –∑–∞–≤–∏—Å–∏–º–æ—Å—Ç–∏ —É–ø—Ä–∞–≤–ª—è—é—Ç—Å—è —á–µ—Ä–µ–∑ DI –∫–æ–Ω—Ç–µ–π–Ω–µ—Ä
- **‚úÖ –¢–µ—Å—Ç–∏—Ä—É–µ–º–æ—Å—Ç—å**: PeriodService –º–æ–∂–Ω–æ –ª–µ–≥–∫–æ –º–æ–∫–∞—Ç—å –≤ —Ç–µ—Å—Ç–∞—Ö

### –°–æ–æ—Ç–≤–µ—Ç—Å—Ç–≤–∏–µ –ø—Ä–∏–Ω—Ü–∏–ø–∞–º –ø—Ä–æ–µ–∫—Ç–∞:
- **‚úÖ –ü–∞—Ç—Ç–µ—Ä–Ω "–§–∞—Å–∞–¥"**: –°–æ—Ö—Ä–∞–Ω–µ–Ω - ReservationRepository –∏ RentalRepository –æ—Å—Ç–∞—é—Ç—Å—è —Ñ–∞—Å–∞–¥–∞–º–∏
- **‚úÖ CQS**: –°–æ—Ö—Ä–∞–Ω–µ–Ω - —Ä–∞–∑–¥–µ–ª–µ–Ω–∏–µ –∫–æ–º–∞–Ω–¥ –∏ –∑–∞–ø—Ä–æ—Å–æ–≤ –Ω–µ –Ω–∞—Ä—É—à–µ–Ω–æ
- **‚úÖ Repository Pattern**: –£—Å–∏–ª–µ–Ω - –≤—Å–µ –∑–∞–≤–∏—Å–∏–º–æ—Å—Ç–∏ –ø—Ä–æ—Ö–æ–¥—è—Ç —á–µ—Ä–µ–∑ –∫–æ–Ω—Å—Ç—Ä—É–∫—Ç–æ—Ä—ã
- **‚úÖ DI**: –ü–æ–ª–Ω–æ—Å—Ç—å—é —Å–æ–±–ª—é–¥–µ–Ω - –Ω–∏–∫–∞–∫–∏—Ö –ø—Ä—è–º—ã—Ö —Å–æ–∑–¥–∞–Ω–∏–π —ç–∫–∑–µ–º–ø–ª—è—Ä–æ–≤

### –û–±—Ä–∞—Ç–Ω–∞—è —Å–æ–≤–º–µ—Å—Ç–∏–º–æ—Å—Ç—å:
- **‚úÖ API –∫–æ–Ω—Ç—Ä–∞–∫—Ç—ã**: –ù–µ –∏–∑–º–µ–Ω–µ–Ω—ã
- **‚úÖ –ü—É–±–ª–∏—á–Ω—ã–µ –º–µ—Ç–æ–¥—ã**: –ù–µ –∏–∑–º–µ–Ω–µ–Ω—ã
- **‚úÖ –ü–æ–≤–µ–¥–µ–Ω–∏–µ**: –ò–¥–µ–Ω—Ç–∏—á–Ω–æ –ø—Ä–µ–¥—ã–¥—É—â–µ–º—É

## üîç –ü—Ä–æ–≤–µ—Ä–∫–∞ –∫–∞—á–µ—Å—Ç–≤–∞

### –õ–∏–Ω—Ç–µ—Ä:
- **‚úÖ –û—à–∏–±–∫–∏ –ª–∏–Ω—Ç–µ—Ä–∞**: –ò—Å–ø—Ä–∞–≤–ª–µ–Ω—ã –≤—Å–µ –ø—Ä–µ–¥—É–ø—Ä–µ–∂–¥–µ–Ω–∏—è
- **‚úÖ –¢–∏–ø–∏–∑–∞—Ü–∏—è**: –°–æ—Ö—Ä–∞–Ω–µ–Ω–∞ –ø–æ–ª–Ω–∞—è —Ç–∏–ø–∏–∑–∞—Ü–∏—è
- **‚úÖ –ò–º–ø–æ—Ä—Ç—ã**: –ö–æ—Ä—Ä–µ–∫—Ç–Ω–æ –æ—Ä–≥–∞–Ω–∏–∑–æ–≤–∞–Ω—ã

### –ê—Ä—Ö–∏—Ç–µ–∫—Ç—É—Ä–Ω–∞—è –≤–∞–ª–∏–¥–∞—Ü–∏—è:
- **‚úÖ DI –∫–æ–Ω—Ç–µ–π–Ω–µ—Ä**: –í—Å–µ –∑–∞–≤–∏—Å–∏–º–æ—Å—Ç–∏ –∫–æ—Ä—Ä–µ–∫—Ç–Ω–æ –∑–∞—Ä–µ–≥–∏—Å—Ç—Ä–∏—Ä–æ–≤–∞–Ω—ã
- **‚úÖ –¶–∏–∫–ª–∏—á–µ—Å–∫–∏–µ –∑–∞–≤–∏—Å–∏–º–æ—Å—Ç–∏**: –û—Ç—Å—É—Ç—Å—Ç–≤—É—é—Ç
- **‚úÖ –ü–æ—Ä—è–¥–æ–∫ –∏–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏–∏**: –ö–æ—Ä—Ä–µ–∫—Ç–Ω—ã–π

## üìä –ú–µ—Ç—Ä–∏–∫–∏ —É–ª—É—á—à–µ–Ω–∏—è

| –ê—Å–ø–µ–∫—Ç | –î–æ –∏—Å–ø—Ä–∞–≤–ª–µ–Ω–∏—è | –ü–æ—Å–ª–µ –∏—Å–ø—Ä–∞–≤–ª–µ–Ω–∏—è |
|--------|----------------|-------------------|
| –°–æ–±–ª—é–¥–µ–Ω–∏–µ DI | ‚ùå 0% | ‚úÖ 100% |
| –ê—Ä—Ö–∏—Ç–µ–∫—Ç—É—Ä–Ω–∞—è —á–∏—Å—Ç–æ—Ç–∞ | ‚ö†Ô∏è 70% | ‚úÖ 100% |
| –¢–µ—Å—Ç–∏—Ä—É–µ–º–æ—Å—Ç—å | ‚ö†Ô∏è 60% | ‚úÖ 100% |
| –£–ø—Ä–∞–≤–ª—è–µ–º–æ—Å—Ç—å –∑–∞–≤–∏—Å–∏–º–æ—Å—Ç–µ–π | ‚ùå 0% | ‚úÖ 100% |

## üéØ –ó–∞–∫–ª—é—á–µ–Ω–∏–µ

–ö—Ä–∏—Ç–∏—á–µ—Å–∫–æ–µ –Ω–∞—Ä—É—à–µ–Ω–∏–µ –∞—Ä—Ö–∏—Ç–µ–∫—Ç—É—Ä–Ω–æ–≥–æ –ø—Ä–∏–Ω—Ü–∏–ø–∞ Dependency Injection –ø–æ–ª–Ω–æ—Å—Ç—å—é –∏—Å–ø—Ä–∞–≤–ª–µ–Ω–æ. –¢–µ–ø–µ—Ä—å:

1. **PeriodService** –∫–æ—Ä—Ä–µ–∫—Ç–Ω–æ –≤–Ω–µ–¥—Ä—è–µ—Ç—Å—è —á–µ—Ä–µ–∑ DI –∫–æ–Ω—Ç–µ–π–Ω–µ—Ä
2. **–†–µ–ø–æ–∑–∏—Ç–æ—Ä–∏–∏** –ø–æ–ª—É—á–∞—é—Ç –∑–∞–≤–∏—Å–∏–º–æ—Å—Ç–∏ —á–µ—Ä–µ–∑ –∫–æ–Ω—Å—Ç—Ä—É–∫—Ç–æ—Ä—ã
3. **–ê—Ä—Ö–∏—Ç–µ–∫—Ç—É—Ä–∞** –ø–æ–ª–Ω–æ—Å—Ç—å—é —Å–æ–æ—Ç–≤–µ—Ç—Å—Ç–≤—É–µ—Ç –ø—Ä–∏–Ω—Ü–∏–ø–∞–º –ø—Ä–æ–µ–∫—Ç–∞
4. **–û–±—Ä–∞—Ç–Ω–∞—è —Å–æ–≤–º–µ—Å—Ç–∏–º–æ—Å—Ç—å** —Å–æ—Ö—Ä–∞–Ω–µ–Ω–∞
5. **–¢–µ—Å—Ç–∏—Ä—É–µ–º–æ—Å—Ç—å** –∑–Ω–∞—á–∏—Ç–µ–ª—å–Ω–æ —É–ª—É—á—à–µ–Ω–∞

**–§–∏–Ω–∞–ª—å–Ω–∞—è —Å—Ç–µ–ø–µ–Ω—å —É–≤–µ—Ä–µ–Ω–Ω–æ—Å—Ç–∏: 100%** - –≤—Å–µ –∞—Ä—Ö–∏—Ç–µ–∫—Ç—É—Ä–Ω—ã–µ –ø—Ä–∏–Ω—Ü–∏–ø—ã —Å—Ç—Ä–æ–≥–æ —Å–æ–±–ª—é–¥–µ–Ω—ã.

---

**–î–∞—Ç–∞ –∏—Å–ø—Ä–∞–≤–ª–µ–Ω–∏—è**: 15 —è–Ω–≤–∞—Ä—è 2025  
**–í—Ä–µ–º—è –∏—Å–ø—Ä–∞–≤–ª–µ–Ω–∏—è**: ~1 —á–∞—Å  
**–°—Ç–∞—Ç—É—Å**: ‚úÖ –ö—Ä–∏—Ç–∏—á–µ—Å–∫–∏–µ –Ω–∞—Ä—É—à–µ–Ω–∏—è –∏—Å–ø—Ä–∞–≤–ª–µ–Ω—ã
